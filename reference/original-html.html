<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Code Evolver</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Fira+Code&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617; /* slate-950 */
        }
        .code-block {
            font-family: 'Fira Code', monospace;
            background-color: #0F172A; /* slate-900 */
            border: 1px solid #1E293B; /* slate-800 */
            border-radius: 0.75rem;
            padding: 1rem;
            height: 400px;
            overflow-y: auto;
            color: #E2E8F0; /* slate-200 */
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body class="text-slate-300 min-h-screen flex flex-col">
    <div class="container mx-auto p-4 md:p-8 flex-grow">
        <header class="text-center my-8">
            <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-green-400 to-sky-500 text-transparent bg-clip-text">
                AI Code Evolver
            </h1>
            <p class="text-slate-500 mt-2">
                Paste your Python function and let an AI discover a more optimal version.
            </p>
        </header>

        <main>
            <div class="mb-6 max-w-lg mx-auto">
                <label for="apiKey" class="block text-sm font-medium text-slate-400 mb-2">Google AI Studio API Key</label>
                <input type="password" id="apiKey" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 text-slate-200 focus:ring-2 focus:ring-sky-500 focus:outline-none transition-all" placeholder="Enter your API key...">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                <div>
                    <h2 class="text-xl font-semibold mb-4 text-center">Your Code</h2>
                    <textarea id="codeInput" class="code-block w-full text-sm" spellcheck="false">def reverse_function(s):
    reversed_s = ""
    for char in s:
        reversed_s = char + reversed_s
    return reversed_s</textarea>
                </div>

                <div>
                    <h2 class="text-xl font-semibold mb-4 text-center">AI Evolved Code</h2>
                    <div id="outputCode" class="code-block text-sm"></div>
                </div>
            </div>

            <div class="text-center mt-8">
                <button id="evolveButton" class="bg-gradient-to-r from-green-500 to-sky-500 hover:from-green-600 hover:to-sky-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg transform hover:scale-105 transition-all duration-300">
                    Evolve
                </button>
                <p id="status" class="text-slate-500 mt-4 h-5">Waiting for input...</p>
            </div>
        </main>
    </div>

    <footer class="text-center p-4 text-xs text-slate-600">
        <p>Inspired by Google DeepMind research: AlphaEvolve</p>
    </footer>

    <script>
        const apiKeyInput = document.getElementById('apiKey');
        const codeInput = document.getElementById('codeInput');
        const outputCode = document.getElementById('outputCode');
        const evolveButton = document.getElementById('evolveButton');
        const statusText = document.getElementById('status');

        evolveButton.addEventListener('click', handleEvolveClick);

        async function handleEvolveClick() {
            const apiKey = apiKeyInput.value.trim();
            const userCode = codeInput.value.trim();

            if (!apiKey) {
                alert("Please enter your API key.");
                return;
            }
            if (!userCode) {
                alert("Please enter code to evolve.");
                return;
            }

            evolveButton.disabled = true;
            evolveButton.textContent = "Evolving...";
            statusText.textContent = "Connecting to the Gemini API...";
            outputCode.textContent = '';

            try {
                const evolvedCode = await getLlmSuggestion(apiKey, userCode);
                outputCode.textContent = evolvedCode;
                statusText.textContent = "Evolution complete!";
            } catch (error) {
                statusText.textContent = `Error: ${error.message}`;
                console.error(error);
            } finally {
                evolveButton.disabled = false;
                evolveButton.textContent = "Evolve";
            }
        }

        function createPrompt(codeString) {
            return `You are an expert Python programmer. Your task is to take a given Python function and propose a functionally equivalent but more efficient and Pythonic version. Your goal is to dramatically improve the function's performance. **CRITICAL**: You must provide *only* the complete, new Python function in your response. Do not include any explanations, introductory text, or markdown formatting like \`\`\`python. Here is the function to improve:\n\`\`\`python\n${codeString}\n\`\`\``;
        }

        async function getLlmSuggestion(apiKey, userCode) {
            const model = 'gemini-1.5-flash-latest';
            const apiURL = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
            const prompt = createPrompt(userCode);
            const payload = {
                contents: [{
                    parts: [{
                        text: prompt
                    }]
                }]
            };

            statusText.textContent = "AI is generating the new code...";
            const response = await fetch(apiURL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error.message || "API request failed");
            }

            const data = await response.json();
            if (!data.candidates || !data.candidates[0].content.parts[0].text) {
                throw new Error("Invalid response from API.");
            }

            // Clean the response to remove markdown
            const cleanedCode = data.candidates[0].content.parts[0].text
                .trim()
                .replace(/^\`\`\`python\s*/, '')
                .replace(/\`\`\`$/, '')
                .trim();

            return cleanedCode;
        }
    </script>
</body>
</html>
